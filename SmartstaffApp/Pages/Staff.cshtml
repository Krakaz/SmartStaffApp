@page
@model StaffModel
@{
    ViewData["Title"] = "Staff";
    Layout = "~/Pages/Shared/_Layout.cshtml";
}

<h1>Сотрудники</h1>
<div>
    @{
        <table class="table table-striped">
            <tr class="table-warning" style="font-weight: bold;">
                @foreach (var item in Model.ShortActiveStaffs)
                {
                <td>@item.DirectionName</td>
                }
                <td>Всего</td>
            </tr>
            <tr>
                @foreach (var item in Model.ShortActiveStaffs)
                {
                <td>@item.StaffCount</td>
                }
                <td sstyle="font-weight: bold;">@Model.ShortActiveStaffs.Sum(el => el.StaffCount)</td>
            </tr>
        </table>
    }
</div>
<br />
<form method="get" onsubmit="submitForm()">
    <label for="staffStatus" style="margin-left: 10px;">Статус</label>
    @Html.DropDownListFor(m => m.Filter.StaffStatusId, Model.StaffStatus, new { id = "staffStatusId", onChange = "this.form.submit()" })

    <label for="staffArivedStatus" style="margin-left: 10px;">Статус прибытия</label>
    @Html.DropDownListFor(m => m.Filter.StaffArivedStatusId, Model.StaffArivedStatus, new { id = "staffArivedStatusId", onChange = "this.form.submit()" })

    <label for="directionId" style="margin-left: 10px;">Направление</label>
    @Html.DropDownListFor(m => m.Filter.DirectionId, Model.Directions, new { id = "directionId", onChange = "this.form.submit()" })
</form>
<br />

<div>
    @{ var index = 0;}
    <table class="table table-striped" style="font-size: 12px;">
        <tr class="table-primary" style="font-weight: bold;">
            <td>№</td>
            <td><a asp-page="./Staff" asp-route-sortOrder=@Model.Sort.Name>ФИО</a></td>
            <td><a asp-page="./Staff" asp-route-sortOrder=@Model.Sort.Birthday>День рождения</a></td>
            <td><a asp-page="./Staff" asp-route-sortOrder=@Model.Sort.FirstWorkingDate>Первый рабочий день</a></td>
            <td><a asp-page="./Staff" asp-route-sortOrder=@Model.Sort.Position>Должность</a></td>
            <td><a asp-page="./Staff" asp-route-sortOrder=@Model.Sort.Direction>Направление</a></td>
            <td><a asp-page="./Staff" asp-route-sortOrder=@Model.Sort.Phone>Телефон</a></td>
        </tr>
        @foreach (var row in @Model.Staffs)
        {
            var cl = (!row.IsActive) ? "class=table-danger" : (row.IsArived) ? "class=table-info" : "";
            index++;

        <tr @cl>
            <td>@index</td>
            <td><a href="https://smartstaff.simbirsoft1.com/pages/employee/view.xhtml?id=@row.Id" target="_blank">@row.FullName</a></td>
            <td>@row.Birthday?.ToString("dd.MM.yyyy")</td>
            <td>@row.FirstWorkingDate.ToString("dd.MM.yyyy")</td>
            <td>@row.Position</td>
            <td>@row.Direction</td>
            <td>@row.Phones</td>
        </tr>
            
        }

    </table>
</div>
<script>
    //document.addEventListener('DOMContentLoaded', function () {

    //    LoadSelectFromLocalStorage("staffStatusId", "1");
    //    LoadSelectFromLocalStorage("directionId", "0");
    //    LoadSelectFromLocalStorage("staffArivedStatusId", "0");
        
    //});
    //function submitForm() {
    //    SaveSelectToLocalStorage("staffStatusId");
    //    SaveSelectToLocalStorage("directionId");
    //    SaveSelectToLocalStorage("staffArivedStatusId");
    //}


</script>
